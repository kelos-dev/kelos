apiVersion: axon.io/v1alpha1
kind: TaskSpawner
metadata:
  name: axon-fake-user
spec:
  when:
    cron:
      schedule: "0 9 * * *"
  maxConcurrency: 1
  taskTemplate:
    workspaceRef:
      name: axon-agent
    model: sonnet
    type: claude-code
    ttlSecondsAfterFinished: 3600
    credentials:
      type: oauth
      secretRef:
        name: axon-credentials
    podOverrides:
      resources:
        requests:
          cpu: "250m"
          memory: "512Mi"
          ephemeral-storage: "2Gi"
        limits:
          cpu: "1"
          memory: "2Gi"
          ephemeral-storage: "2Gi"
    agentConfigRef:
      name: axon-dev-agent
    promptTemplate: |
      You are a developer experience tester for the Axon framework — a Kubernetes-native controller that runs autonomous AI coding agents.
      Your goal is to improve Axon so that more developers adopt it. Act as a new user trying out the project for the first time.

      Task:
      Pick ONE of the following areas to focus on (choose the one most likely to have actionable improvements):

      1. **Documentation & Onboarding**
         - Read the README and try to follow the getting-started instructions
         - Check if CLI help text (`axon --help`, `axon run --help`, etc.) is clear
         - Look for missing or outdated documentation

      2. **Developer Experience**
         - Review error messages — are they actionable and helpful?
         - Check if common workflows are easy to accomplish
         - Look for rough edges in the CLI or API

      3. **Examples & Use Cases**
         - Review existing examples in `examples/` and `self-development/`
         - Check if example manifests are correct and well-documented
         - Identify missing examples that would help new users

      Actions:
      - If you find an issue, create a GitHub issue:
        ```
        gh issue create --title "<title>" --body "<description>" --label generated-by-axon --label axon/needs-input
        ```
      - If you can fix something small, create a PR:
        ```
        git checkout -b axon-fake-user-{{.ID}}
        # ... make changes ...
        git push -u origin axon-fake-user-{{.ID}}
        gh pr create --title "<title>" --body "<description>" --label generated-by-axon --label ok-to-test
        ```
      - Prefer creating focused issues over large PRs

      Constraints:
      - Focus on ONE area per run, do it thoroughly
      - Do not create duplicate issues — check existing issues first with `gh issue list`
      - Keep changes minimal and focused
      - Before creating output, review recent issues labeled "generated-by-axon" (`gh issue list --label generated-by-axon --limit 10`) to avoid overlap with other agents and to learn what has been well-received vs dismissed
      - If after reviewing existing issues you cannot identify something genuinely new and actionable, exit without creating an issue or PR. Not every run needs to produce output
  pollInterval: 1m
